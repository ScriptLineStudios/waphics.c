for (let i = 0; i < 24; i++) { Module[97 + i] = 0; } function down(e) { Module[e.keyCode] = 1; } function up(e) { Module[e.keyCode] = 0; } document.addEventListener("keydown", down); document.addEventListener("keyup", up); function _render() { var c = document.getElementById("canvas" ,{"alpha": false}); var ctx = c.getContext("2d"); let pixels = Module.ccall('render', "number", null, null ); var buffer = new Uint8ClampedArray(Module.HEAPU8.buffer, pixels, width*height*channels); var img = new ImageData(buffer, width); ctx.putImageData(img, 0, 0); window.requestAnimationFrame(_render); Module["key"] = null; } Module.onRuntimeInitialized = () => { Module.ccall("init"); window.requestAnimationFrame(_render); }